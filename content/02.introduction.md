## 1. Introduction

Molecular mechanics (MM) small molecule force fields are essential to the molecular design for chemical
biology and drug discovery, as well as the use of molecular simulation to understand the
behavior of biomolecular systems. However, small molecule force fields have lagged behind
protein force fields given the larger chemical space these force fields must cover to provide good
accuracy over the space fo druglike ligands, common metabolites and other small biomolecules [@doi:10.1021/acs.jctc.8b00821; @doi:10.1021/acs.jctc.5b00864].
Torsion parameters are particularly problematic because historical approaches to their determination tend to produce
parameters that generalize poorly [@doi:10.1186/s13321-019-0371-6]. This lack of generalizability has let many practitioners
to aim to improve the force field accuracy by refitting torsion
parameters for individual molecules in a semi automated bespoke fashion [@doi:10.1002/jcc.23775; @doi:10.1002/jcc.23422;
@doi:10.1021/ci500112w]. This leads to a significant barrier to setting up simulations for new projects and may not produce
generalizable parameters.

In many molecular mechanics force fields (e.g., Amber [@doi:10.1021/ja00124a002],
CHARMM [@doi:10.1002/jcc.540040211], OPLS [@doi:10.1021/ja9621760]) a low-order Fourier series, such as
a cosine series, is often used to represent the contribution of torsion terms to the potential energy.

$$ E_{tor} = \sum_{n=1}^{N} \frac{V_n}{2}[1 + cos[n(\theta - \gamma)]]$$

where $V_i$ is the torsion force constant which determines the amplitudes, $n$ is the multiplicity which determines the
number of minimas, and $\gamma$ is the phase angle which is sometimes set to $0^{\circ}$ or $180^{\circ}$ to enforce
symmetry around zero. In most force fields $N$ is 4, however, some go up to 7.
The torsion potential energy parameters such as amplitudes and phase angles for each Fourier term, 
are generally fit to the residual difference between gas phase quantum chemistry (QC) torsion energy 
profile and the non-torsion MM parameters [@doi:10.1007/s00894-008-0305-0]. The QC torsion energy profile
is generated by fixing the torsion atoms and geometry minimizing all other atomic positions. 
Neighboring torsions can have correlated conformational preferences the low-order Fourier series does not capture[@doi:10.1038/s41598-018-21070-0]. 
2D spline fits, such as CMAP [@doi:10.1002/jcc.20082; @doi:10.26434/chemrxiv.8279681], have become a popular
way to model non-local correlations by fitting residuals between the 2D QC torsion energy profile and the 2D
MM torsion energy profile. 

In order to produce a quantum chemical energy profile representing the chemical environment that the torsion of interest is to be fit to, the
quantum chemical torsion profile is generally computed on smaller fragments generated by a fragmentation-and-capping process
for two main reasons.

![**Fragmenting molecules is necessary to avoid high computational cost of generating QC data.**
**[A]** CPU time (wall time * nthreads) of one QC gradient evaluation at B3LYP-D3(BJ)/DZVP level of theory [@doi:10.1063/1.3382344; @doi:10.1139/v92-079] vs number
of heavy atoms in molecules. All computations shown here were run on an Intel(R) Xeon(R) CPU E5-2697 v4 @ 2.30GHz.
Empirically, gradient evaluations grow as $O(N^{2.6})$ where $N$ is the number of heavy atoms. The scaling is similar
on other processors shown in SI Figures @fig:intel_scaling & @fig:amd_scaling. The black curves shows a power law fit to the data,
and the grey is the 95% CI of the curve estimate.
**[B]** Smoothed histogram of heavy atoms in small molecules from DrugBank. The average druglike molecules has 25 heavy atoms.](images/B3LYP_scaling_1.svg){#fig:b3lyp_scaling}

1. **Computational efforts scale poorly with molecule size**.
Generating one dimensional QC torsion profiles are computationally expensive and become increasingly inefficient
for larger molecules and/or higher dimensional QC torsion profiles. QC calculations scale poorly with the number
of basis sets $N$, like $O(N^M)$ where formally, $M\leq 4$ for hybrid DFT. With modern implementations, hybrid DFT scales
asymptotically as $~N^{2.2-2.3}$ [@doi:10.1063/1.468836]. Using QCArchive data [@url:https://qcarchive.molssi.org/], we found that
practically, hybrid DFT grows like $~N^{2.6}$ for the DZVP basis as shown for gradient evaluations in Figure @fig:b3lyp_scaling, A. To achieve good sampling to adequately fit the torsions,
constrained geometry optimizations need to be calculated at $\leq 15^0$ intervals for a minimum of 24 constrained 
geometry optimizations. To avoid hysteresis in the energy profile due to orthogonal degrees of freedom [@doi:10.1021/acs.jpcb.7b02320],
methods like wavefront propagation `[hold for CITE torsiondrive paper]`{.red} are used. This adds a factor of 2D, where D is the dimension of the QC scan,
to the computational cost. We found (SI Figure @fig:opts_per_td) that on average ~60 optimizations are needed for a 1D wavefront propagated torsion
drive to converge. We also found that roughly 20 gradient evaluations are needed for an optimization to to converge for the
molecules we optimized (SI Figure @fig:grads_per_opt). Figure @fig:b3lyp_scaling, B shows a smoothed histogram of the distribution of
the number of heavy atoms in FDA approved small molecules taken from DrugBank [@doi:10.1093/nar/gkx1037]. For an average
druglike molecule of 25 heavy atoms, we can estimate the cost of a 1D torsion scan to be $60 * 20 * 0.26 * 25^{2.6} \approx 1,000,000$ CPU seconds.
Reducing the size of the molecule to 15 heavy atoms will reduce the cost the torsion scan by an order of magnitude ($60 * 20 * 0.26 * 15^{2.6} \approx 300,000$ CPU seconds)

2. **Intramolecular interactions complicate torsion drives and torsion parameter fitting**
In larger molecules, there is a greater potential for the torsion atoms to interact with other degrees of freedom and
convolute the energy profile. While this can also happen in smaller molecules such as ethylene glycol `[hold to CITE torsiondrive paper]`{.red}
this problem is reduced when a minimal model molecule is used, albeit not completely eliminated.

While a number of algorithms for fragmenting large molecules into smaller molecular fragments have been previously proposed,
few are appropriate for the purpose of generating high-quality torsion scans. Many of these algorithms fall into two
categories: 1. fragmentation for synthetic accessibility [@doi:10.1021/ci970429i;
@doi:10.1021/acs.jcim.6b00596; @doi:10.1021/jm9602928] and 2. fragmenting molecules to achieve linear scaling for QC calculations
[@doi:10.1002/jcc.25149; @doi:10.1063/1.1879792; @doi:10.1021/cr200093j; @doi:10.1039/c2cp23832b]. 
Fragmentation schemes for synthetic accessibility find building blocks for combinatorial and fragment based drug design. 
Cleavage happens at points where it makes sense for chemical reactions and do not consider how those cuts affect the 
electronic properties of the fragments. For retrosynthetic applications, many cleavage points are at functional groups because 
those are the reactive sites of molecules. However, for our application, we especially do not want to fragment at these
reactive points given how electron rich they are and how much the electronic density changes when they are altered. 
Fragmentation algorithms for linear scaling such as Divide-and-Conquer methods [@doi:10.1063/1.472136], effective fragment potential method
[@doi:10.1002/jcc.10309] and systematic molecular fragmentation methods [@doi:10.1039/c2cp23832b] require the users to manually 
specify where the cuts should be or which bonds not to fragment. Furthermore, besides the scheme suggested by Rai et. al. [@doi:10.1021/acs.jcim.9b00373], none of these methods address the needs specific
to fragmenting molecules for QC torsion scans. Fragments need to include all atoms involved in 1-4 interactions, since they 
are incorporated in the fitting procedure. We also need a systematic way to determine if remote substituents change
the barrier to rotation significantly for the central bond of interest.

In this work, we use the Wiberg Bond Order (WBO) [@doi:10/fvwkkh], which is both simple to calculate
from semi-empirical QC methods and is sensitive to the chemical environment around a bond. WBOs quantify electron population
overlap between bonds, or the degree of binding between atoms. Bond orders are correlated with bond
vibrational frequencies [@doi:10.1021/jp4010345; @doi:10.1351/pac198961040635] and WBOs are used to predict trigger bonds in high energy-density material
because it is correlated with the strength of the bond [@doi:10.1002/cphc.201500773]. Wei, et. al. [@doi:10.1021/acs.jcim.9b00585] have shown
that simple rules for electron richness of aromatic systems in biaryls are good indication of torsion force constants (specifically for V~2~), however, this
measure was only developed for biaryls and it does not take into account substituents beyond the aromatic ring directly adjacent to the bond.
Here, we develop an approach that uses the WBO to validate whether a fragmentation scheme corrupts the local chemical environment of interest,
with a particular focus on fragmentation schemes suitable for QC torsion drives. Our approach uses simple 
heuristics to arrive at a minimal fragment for QM torsion scan that is representative of of the torsion scan of the 
substructure in the parent molecules. For a central bond, include all atoms that are involved in the sterics 
of a torsion scan. Then use the WBO as a surrogate signal to determine if the fragment needs to be
grown out more to restore the correct electronics around the central bonds. 

The paper is organizes as follows:
Section 2 provides a mathematical and physical definition of the problem.
Section 3 provides the motivation for using the WBO as a surrogate, evaluates how robust it is, proposes a minimal 
fragmentation scheme and describes a rich validation set that can be used to benchmark fragmentation schemes
Section 4 provides a discussion of the implications of this study and section 5 provides detailed methods. 
